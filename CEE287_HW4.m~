%% CEE 287: Homework 4
% Max Ferguson
% Nicole Paul

%% PART A - Problem 1

Tn = 1.5;
E = 0.05;
alpha = -0.15;
u0 = 0;
v0 = 0;
dt = 0.02;
dtnew = 0.01;
load(fullfile('OtherData','ElCentroGMTH.mat'));
A = A_ElCentro;
A = interpolateGM(A,dt,dtnew);
Cy = 0.129;

[u, v, a, Sd, Sv, Sa, PSv, PSa, Fs, mu] = NewmarkAvgAccAlpha_Cy(Tn, E, A, dtnew, u0, v0, Cy, alpha);

%% 

load(fullfile('OtherData','ElCentro10s'));
Tn = 0.5;
E = 0;
dt = 0.002;
uy = 0.4182;
u0 = 0;
v0 = 0;
M = 1; % assumed, should cancel out
g = 386;
wn = 2*pi/Tn;
C = 2*E*wn*M;
K = wn^2*M;
Cy = uy*K/(M*g);
alpha = 0;
%[u, v, a, Sd, Sv, Sa, PSv, PSa, Fs, mu] = NewmarkAvgPrev(Tn, E, A_ElCentro, dt, u0, v0, Cy, 0);
[u, v, a, Sd, Sv, Sa, PSv, PSa, Fs, mu] = NewmarkAvgAccAlpha_Cy(Tn, E, A_ElCentro, dt, u0, v0, Cy, alpha);

%% Part A - Problem 2

% Structure information
Tn = 1.0;
E = 0.05;
alpha = -0.15;
u0 = 0;
v0 = 0;

% Loading GM Information
FileList = dir('LomaPrietaGM');
N = size(FileList, 1);
for i = 4:N
    load(fullfile('LomaPrietaGM',FileList(i).name));
end
convtog = 0.00101971621;
GM = convtog*[Parking(:,2) SLAC_1(:,2) SLAC_2(:,2) VA_1(:,2) VA_2(:,2)];
dt = Parking(:,1); % same for all GM
nGM = 5;

% Using root-finding algorithm to find Cy for mu=1 for each GM
fn = @(C, A) FindMu2(Tn, E, A, dt, u0, v0, C, alpha) - 1;
muvec = NaN(nGM, 1);
for i = 1:nGM
    fn_A = @(C) fn(C, GM(:,i));
    muvec(i) = fzero(fn_A, 0.5);
end

%% Plotting entire goddamn thing

m = 100;
Cy_range = linspace(0,1,m);
mu_mat = zeros(m, nGM);
for i = 1:nGM
    for j = 1:m
        mu_mat(j,i) = FindMu2(Tn, E, GM(:,i), dt, u0, v0, C, alpha);
    end
end
    
figure;
plot(mu_mat,Cy_range); grid on;
xlabel('



